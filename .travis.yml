language: cpp
compiler:
  - gcc
install:
  - sudo apt-get update -y
  - sudo apt-get install -y gcc-mingw-w64-x86-64 g++-mingw-w64-x86-64 binutils-mingw-w64-x86-64 mingw-w64-dev
  - sudo apt-get install -y cmake
script:
  - mkdir target
  - cd target
  - cmake .. -DCMAKE_TOOLCHAIN_FILE=../mingw-w64.cmake -DBUILD_DOCS=0 -DENABLE_PRECOMPILED_HEADERS=0 -DBUILD_TESTS=0 -DBUILD_PERF_TESTS=0 -DBUILD_WITH_DEBUG_INFO=0 -DBUILD_EXAMPLES=0 -DBUILD_SHARED_LIBS=1
  - make
  - make install
before_deploy:
  - cd install
  - zip opencv.zip -r .
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: h0aZSLt2vyiX014QKt6b4A02GTBl6F8ZZB50njk0UMJbbqSkJjNX6NYXIg3BHsjU7lD9TMIeNP5ZUuDe5GrX1bnyvf/kstC+1xJ7B2xQPTAgh52vG8q37ozNPR26rlJIqf1g7ZFdtQERYpm5ZuDfKA9KKXMtyl14sldd8I+VzMg=
  file: opencv.zip
  on:
    tags: true
    repo: firepick-delta/opencv
    branch: mingw-w64
